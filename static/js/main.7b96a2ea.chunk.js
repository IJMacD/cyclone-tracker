(window["webpackJsonpcyclone-track"]=window["webpackJsonpcyclone-track"]||[]).push([[0],{12:function(t,e,n){t.exports=n(20)},17:function(t,e,n){},19:function(t,e,n){},20:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(5),o=n.n(i),l=(n(17),n(1)),c=n.n(l),u=n(3),s=n(6),h=n(7),f=n(10),d=n(8),m=n(11),v=n(9),y=n(2);var p=function(){var t=Object(a.useState)({}),e=Object(y.a)(t,2),n=e[0],r=e[1],i=Object(a.useRef)();return Object(a.useLayoutEffect)(function(){if(i.current){var t=function(){return window.requestAnimationFrame(function(){return r(function(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height,top:"x"in e?e.x:e.top,left:"y"in e?e.y:e.left,x:"x"in e?e.x:e.left,y:"y"in e?e.y:e.top,right:e.right,bottom:e.bottom}}(i.current))})};return t(),window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}},[i]),[i,n]},g=22.3025,w=114.174167,S=.033,x=1e3,b=1e3,E=2,C="https://maps.weather.gov.hk/gis-portal/web/data/dirList/satellite_IR_group.txt",k="https://maps.weather.gov.hk/gis-portal/web/data/%{year_utc}%{month_utc}%{day_utc}/satellite/IR1-L1B-10/%{hour_utc}%{minute}/%{year}%{month}%{day}%{hour}%{minute}+%{day_start}%{hour_start_utc}%{minute_start}H08.10S_50N_75_150E--L1B.H08_IR1_10_no_coast.png",L={minLon:75,minLat:-10,maxLon:150,maxLat:56},T=36e5,_={TD:"#303030",TS:"#28911A",STS:"#273AC1",T:"#DD4343",ST:"#F78BC0",SST:"#F78BC0",LOW:"#8FE1ED"};function D(t){var e=t.myLocation,a=t.cyclones,i=t.showSatellite,o=t.time,l=r.a.useRef(),s=r.a.useRef(),h=p(),f=Object(y.a)(h,2),d=f[0],m=f[1],D=m.width,I=void 0===D?x:D,U=m.height,W=devicePixelRatio,N=W*I,R=W*(void 0===U?b:U),P=S*N/2,A=S*R/2,B={minLat:g-A,minLon:w-P,maxLat:g+A,maxLon:w+P,width:N,height:R},H=r.a.useState(),z=Object(y.a)(H,2),Y=z[0],G=z[1],J=r.a.useState(),q=Object(y.a)(J,2),Z=q[0],$=q[1];return r.a.useEffect(function(){function t(){return(t=Object(u.a)(c.a.mark(function t(){var e,n,a,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(C);case 2:return e=t.sent,t.next=5,e.text();case 5:n=t.sent,a=n.split("\n").map(function(t){return t.trim()}).filter(function(t){return t.length>0}),r=a.map(function(t){var e=new Date;return e.setUTCFullYear(t.substr(0,4)),e.setUTCMonth(t.substr(4,2)-1),e.setUTCDate(t.substr(6,2)),e.setUTCHours(t.substr(9,2)),e.setUTCMinutes(t.substr(1,2)),e.setUTCSeconds(0),e.setUTCMilliseconds(0),e}),$(r);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}!function(){t.apply(this,arguments)}()},[]),r.a.useEffect(function(){if(s.current){var t=new Date(o||Date.now());t.setMinutes(10*Math.floor(t.getMinutes()/10)),t.setSeconds(0),t.setTime(+t-T);var e=s.current.getContext("2d");if(i){var n=k.replace(/%{([a-z_]+)}/g,function(e,n){if("year"===n)return t.getUTCFullYear().toString();if("year_utc"===n)return t.getFullYear().toString();if("month"===n)return(t.getMonth()+1).toString().padStart(2,"0");if("month_utc"===n)return(t.getUTCMonth()+1).toString().padStart(2,"0");if("day"===n)return t.getDate().toString().padStart(2,"0");if("day_utc"===n)return t.getUTCDate().toString().padStart(2,"0");if("hour"===n)return t.getHours().toString().padStart(2,"0");if("hour_utc"===n)return t.getUTCHours().toString().padStart(2,"0");var a=10*Math.floor(t.getMinutes()/10);if("minute"===n)return a.toString().padStart(2,"0");var r=new Date(+t-6e5);return"day_start"===n?r.getUTCDate().toString().padStart(2,"0"):"hour_start_utc"===n?r.getUTCHours().toString().padStart(2,"0"):"minute_start"===n?(10*Math.floor(r.getMinutes()/10)).toString().padStart(2,"0"):e}),a=new Image(800,724);a.src=n,a.onload=function(){var t=F({longitude:L.minLon,latitude:L.maxLat},B),n=t.x,r=t.y,i=F({longitude:L.maxLon,latitude:L.minLat},B),o=i.x,l=i.y;e.drawImage(a,n,r,o-n,l-r)}}else e.clearRect(0,0,B.width,B.height)}},[Z,B,s,i,o]),r.a.useEffect(function(){if(d.current){var t=d.current.getContext("2d");if(t.clearRect(0,0,B.width,B.height),e){var n=F(e,B),r=n.x,l=n.y;t.beginPath();var c=2*W;t.ellipse(r,l,c,c,0,0,2*Math.PI),t.fillStyle="#FF0000",t.fill()}var u=!0,s=!1,h=void 0;try{for(var f,m=a[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var y=f.value,p=j(y,o);if(!i&&p&&p.windspeed){var g=F(p,B),w=g.x,S=g.y;t.beginPath();var x=p.windspeed*E*W;t.ellipse(w,S,x,x,0,0,2*Math.PI);var b=t.createRadialGradient(w,S,10*W,w,S,x);b.addColorStop(0,"#C0C0C0"),b.addColorStop(.9,"#C0C0C0"),b.addColorStop(1,"#FFFFFF"),t.fillStyle=b,t.globalAlpha=.5,t.fill(),t.globalAlpha=1}for(var C=O(y),k=1;k<C.length;k++){var L=C[k-1],T=C[k],D=L[0],I=T[0],U=_[D.classification],N=_[I.classification],R=U;if(U!==N){var P=F(D,B),A=P.x,H=P.y,z=F(I,B),Y=z.x,G=z.y;(R=t.createLinearGradient(A,H,Y,G)).addColorStop(0,U),R.addColorStop(1,N)}var J=4*W,q="P"===I.type?[]:[2*J,2*J];t.setLineDash(q),M(t,B,[].concat(Object(v.a)(L),[I]),R,J),t.setLineDash([])}var Z=!0,$=!1,K=void 0;try{for(var Q,V=y.track[Symbol.iterator]();!(Z=(Q=V.next()).done);Z=!0){var X=Q.value;if(X.windspeed&&X.classification||X===p){t.beginPath();var tt=F(X,B),et=tt.x,nt=tt.y,at=.1*(X.windspeed||50)*W;t.ellipse(et,nt,at,at,0,0,2*Math.PI),t.fillStyle=X===p?"#800080":_[X.classification],t.fill()}}}catch(st){$=!0,K=st}finally{try{Z||null==V.return||V.return()}finally{if($)throw K}}if(p){var rt=F(p,B),it=rt.x,ot=rt.y;t.strokeStyle="#FFFFFF",t.fillStyle="#800080",t.font="".concat(Math.floor(12*W),"px sans-serif");var lt="".concat(y.name," ").concat(y.nameZH);t.strokeText(lt,it,ot+18*W),t.fillText(lt,it,ot+18*W);var ct=p.time.substring(0,13);if(t.strokeText(ct,it,ot+30*W),t.fillText(ct,it,ot+30*W),p.windspeed){var ut="".concat(p.windspeed," km/h");t.strokeText(ut,it,ot+42*W),t.fillText(ut,it,ot+42*W)}}}}catch(st){s=!0,h=st}finally{try{u||null==m.return||m.return()}finally{if(s)throw h}}}},[e,a,B,d,o,W]),r.a.useEffect(function(){function t(){return(t=Object(u.a)(c.a.mark(function t(){var e;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.e(3).then(n.t.bind(null,21,3));case 2:e=t.sent,G(e);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}!function(){t.apply(this,arguments)}()},[]),r.a.useEffect(function(){if(l.current&&Y){var t=l.current.getContext("2d");t.clearRect(0,0,B.width,B.height);var e=!0,n=!1,a=void 0;try{for(var r,i=Y.features[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if("LineString"===o.geometry.type)M(t,B,o.geometry.coordinates.map(function(t){return{latitude:t[1],longitude:t[0]}}),"#80C080",1);else if("MultiLineString"===o.geometry.type){var c=!0,u=!1,s=void 0;try{for(var h,f=o.geometry.coordinates[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var d=h.value;M(t,B,d.map(function(t){return{latitude:t[1],longitude:t[0]}}),"#80C080",1)}}catch(m){u=!0,s=m}finally{try{c||null==f.return||f.return()}finally{if(u)throw s}}}}}catch(m){n=!0,a=m}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}}},[Y,B]),r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("canvas",{ref:s,width:B.width,height:B.height,style:{width:"100vw",height:"100vh",position:"absolute",zIndex:-2}}),r.a.createElement("canvas",{ref:l,width:B.width,height:B.height,style:{width:"100vw",height:"100vh",position:"absolute",zIndex:-1}}),r.a.createElement("canvas",{ref:d,width:B.width,height:B.height,style:{width:"100vw",height:"100vh"}}))}function F(t,e){return{x:(t.longitude-e.minLon)/(e.maxLon-e.minLon)*e.width,y:e.height-(t.latitude-e.minLat)/(e.maxLat-e.minLat)*e.height}}function M(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#000000",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;t.strokeStyle=a,t.lineWidth=r,t.beginPath();var i=!0,o=!0,l=!1,c=void 0;try{for(var u,s=n[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var h=F(u.value,e),f=h.x,d=h.y;i?t.moveTo(f,d):t.lineTo(f,d),i=!1}}catch(m){l=!0,c=m}finally{try{o||null==s.return||s.return()}finally{if(l)throw c}}t.stroke()}"N NNE NE ENE E ESE SE SSE S SSW SW WSW W WNW NW NNW".split(" ");function j(t,e){var n=null;if(e){var a=!0,r=!1,i=void 0;try{for(var o,l=t.track[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var c=o.value;if(+new Date(c.time)>e)return n;n=c}}catch(u){r=!0,i=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}}return t.track.find(function(t){return"A"===t.type})}function O(t){var e=[],n=null,a=!0,r=!1,i=void 0;try{for(var o,l=t.track[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var c=o.value;c.classification?(n&&e.push(n),n=[c]):(n||(console.warn("Expected a point with classification"),n=[]),n.push(c))}}catch(u){r=!0,i=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}return n&&e.push(n),e}n(19);var I=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(f.a)(this,Object(d.a)(e).call(this,t))).state={cyclones:[],myLocation:null,showSatellite:!1,realTime:!1,time:Date.now()},n}return Object(m.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){var t=this;navigator.geolocation.getCurrentPosition(function(e){var n=e.coords;t.setState({myLocation:n})}),this.timeout=setInterval(this.fetchData.bind(this),9e5),this.realtimer=setInterval(function(){return t.state.realTime&&t.setState({time:Date.now()})},6e4),this.fetchData()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timeout),clearInterval(this.realtimer),this.timeout=null}},{key:"fetchData",value:function(){var t=Object(u.a)(c.a.mark(function t(){var e,n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://www.i-learner.edu.hk/weather/api/v2/cyclone");case 2:return e=t.sent,t.next=5,e.json();case 5:n=t.sent,this.timeout&&this.setState({cyclones:n});case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"App"},r.a.createElement(D,{cyclones:this.state.cyclones,myLocation:this.state.myLocation,showSatellite:this.state.showSatellite,time:this.state.realTime?this.state.time:0}),r.a.createElement("ul",{className:"App-key"},this.state.cyclones.map(function(t){return r.a.createElement("li",{key:t.id},t.name," ",t.distance&&"".concat(t.distance," km")," ",t.bearing)}),r.a.createElement("li",null,r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",checked:this.state.showSatellite,onChange:function(e){return t.setState({showSatellite:e.target.checked})}}),"Satellite")),r.a.createElement("li",null,r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",checked:!this.state.realTime,onChange:function(e){return t.setState({realTime:!e.target.checked})}}),"Latest"),this.state.realTime&&r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return t.setState({time:t.state.time-36e5})}},"Earlier"),r.a.createElement("button",{onClick:function(){return t.setState({time:t.state.time+36e5})}},"Later")))))}}]),e}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[12,1,2]]]);
//# sourceMappingURL=main.7b96a2ea.chunk.js.map